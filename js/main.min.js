!function(){if(!window.matchMedia("(max-width: 992px").matches){let t=document.querySelector(".header");window.addEventListener("scroll",()=>{window.pageYOffset>0?t.classList.add("is--active"):t.classList.remove("is--active")})}}(),function(){const t=document.querySelector("body");const e=t=>{t.classList.remove("is--active")},n=()=>{t.classList.toggle("no-scroll")};t.addEventListener("click",t=>{let e=((t,e)=>{let n=t;for(;n;){let t=n.getAttribute(e);if(t)return t;n=n.parentElement}return null})(t.target,"data-popup");if(null===e)return;t.preventDefault();let i=document.querySelector("."+e);i&&((t=>{t.classList.add("is--active")})(i),n())}),t.addEventListener("keydown",t=>{if(27!==t.keyCode)return;let i=document.querySelector(".popup");i&&(e(i),n())}),t.addEventListener("click",t=>{const i=t.target;if(i.classList.contains("popup-close")||i.classList.contains("popup__inner")){const t=((t,e)=>{let n=t;for(;n;){if(n.classList.contains(e))return n;n=n.parentElement}return null})(i,"popup");e(t),n()}})}(),function(){const t=document.querySelector("body");t.addEventListener("click",t=>{const e=((t,e)=>{let n=t;for(;n;){let t=n.getAttribute(e);if(t)return t;n=n.parentElement}return null})(t.target,"data-scroll-to");if(null===e)return;t.preventDefault();const n=document.querySelector("."+e);n&&(t=>{const e=t.getBoundingClientRect().top+window.pageYOffset,n=document.querySelector(".header").clientHeight;window.scrollTo(0,e-n)})(n)})}(),function(){!async function(){const n=await fetch("./js/products.json");t=await n.json(),i(e,t)}();let t=[];const e=document.querySelector(".products__items");const n=t=>{for(;t.firstChild;)t.removeChild(t.firstChild)},i=(t,e)=>{n(t),e.forEach((function(e){const n=`\n    <div class="products__item" data-category="${e.data}">\n      <div class="products__wrapper card" data-id="${e.id}">\n        <img class="product-img" src="img/roll/${e.imgSrc}" alt="">\n      <div class="card__body text-center">\n        <h4 class="item-title">${e.title}</h4>\n        <p><small data-items-in-box class="text-muted">${e.itemsInBox} шт.</small></p>\n\n        <div class="details-wrapper">\n          <div class="items counter-wrapper">\n            <div class="items__control" data-action="minus">-</div>\n            <div class="items__current" data-counter>1</div>\n            <div class="items__control" data-action="plus">+</div>\n          </div>\n\n          <div class="price">\n            <div class="price__weight">${e.weight}г.</div>\n            <div class="price__currency">${e.price} ₽</div>\n          </div>\n        </div>\n\n        <button data-cart type="button" class="btn btn-block btn-outline-warning">+ в корзину</button>\n\n      </div>\n    </div>\n  </div>\n    `;t.insertAdjacentHTML("beforeend",n)}))},r=document.querySelector(".products__list");r.addEventListener("click",n=>{const a=n.target,s=JSON.parse(JSON.stringify(t));let c=((t,e)=>{let n=t;for(;n;){if(n.classList.contains(e))return n;n=n.parentElement}return null})(a,"products__btn");if(null===c||c.classList.contains("is--active"))return;n.preventDefault();let o=c.getAttribute("data-filter");if(r.querySelector(".products__btn.is--active").classList.remove("is--active"),c.classList.add("is--active"),"all"===o)return void i(e,s);let d=[];for(let t=0;t<s.length;t++){let e=s[t];e.data===o&&d.push(e)}i(e,d)});const a=document.querySelector(".order"),s=document.querySelector(".order__total-price"),c=document.querySelector(".cart-wrapper"),o=document.querySelector(".order__list"),d=(document.querySelector(".order__btn"),document.querySelector(".menu__order")),l=document.querySelector(".popup");let u=[];a.addEventListener("click",()=>{n(o),u.forEach(t=>{const e=`\n            <div class="cart-item order__item" data-category="${t.data}" data-id="${t.id}">\n                    <div class="cart-item__img order__img">\n                        <img src="../img/roll/${t.imgSrc}" alt="${t.title}">\n                    </div>\n                    <div class="cart-item__desc order__descr">\n                        <div class="cart-item__title">${t.title}</div>\n                        <div class="cart-item__weight">${t.itemsInBox} / ${t.weight}</div>\n\n                        <div class="cart-item__details">\n                            <div class="price">\n                                <div class="price__currency">${t.price}</div>\n                            </div>\n                        </div>\n                    </div>\n                  <div class="order__total"> x ${t.itemsInCart}</div>\n            </div>`;o.insertAdjacentHTML("afterbegin",e)})}),document.addEventListener("submit",t=>{t.preventDefault(),t.target.reset(),d.classList.remove("is--active"),l.classList.add("is--active"),c.innerHTML="",u.length=0,v()});const m=()=>{const t=document.querySelector(".products__cart"),e=document.querySelector("[data-cart-empty]"),n=document.querySelector("#order-form");t.children.length>0?(e.classList.add("none"),n.classList.remove("none")):(e.classList.remove("none"),n.classList.add("none"))};function v(){const t=document.querySelector(".total-price"),e=document.querySelector(".delivery-cost"),n=document.querySelector("[data-cart-delivery]");let i=0;i=u.reduce((t,e)=>t+e.price*e.itemsInCart,0),t.innerText=i,s.innerText=`Итого: ${i} руб.`,i>0?n.classList.remove("none"):n.classList.add("none"),i>=600?(e.classList.add("free"),e.innerText="бесплатно"):(e.classList.remove("free"),e.innerText="250 ₽")}window.addEventListener("click",(function(t){let e,n;if(t.target.closest(".cart-wrapper")&&(n=+t.target.closest(".cart-item").dataset.id),"plus"===t.target.dataset.action||"minus"===t.target.dataset.action){e=t.target.closest(".counter-wrapper").querySelector("[data-counter]")}"plus"===t.target.dataset.action&&(e.innerText=++e.innerText,u.map(t=>{t.id===n&&(t.itemsInCart++,v())})),"minus"===t.target.dataset.action&&(parseInt(e.innerText)>1?(e.innerText=--e.innerText,u.map(t=>{t.id===n&&(t.itemsInCart--,v())})):t.target.closest(".cart-wrapper")&&1===parseInt(e.innerText)&&(t.target.closest(".cart-item").remove(),u.map((t,e)=>{t.id===n&&u.splice(e,1)}),m(),v())),t.target.hasAttribute("data-action")&&t.target.closest(".cart-wrapper")&&v()})),window.addEventListener("click",(function(e){if(e.target.hasAttribute("data-cart")){const n=e.target.closest(".card"),i=+n.dataset.id,r=+n.querySelector("[data-counter]").innerText,a=c.querySelector(`[data-id="${i}"]`),s=t=>{const e=`\n            <div class="cart-item" data-id="${t.id}">\n                <div class="cart-item__top">\n                    <div class="cart-item__img">\n                        <img src="../img/roll/${t.imgSrc}" alt="${t.title}">\n                    </div>\n                    <div class="cart-item__desc">\n                        <div class="cart-item__title">${t.title}</div>\n                        <div class="cart-item__weight">${t.itemsInBox} / ${t.weight}</div>\n\n                        <div class="cart-item__details">\n                            <div class="items items--small counter-wrapper">\n                                <div class="items__control" data-action="minus">-</div>\n                                <div class="items__current" data-counter="">${t.itemsInCart}</div>\n                                <div class="items__control" data-action="plus">+</div>\n                            </div>\n\n                            <div class="price">\n                                <div class="price__currency">${t.price}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>`;c.insertAdjacentHTML("beforeend",e)};if(a){const t=a.querySelector("[data-counter]");t.innerText=parseInt(t.innerText)+parseInt(r),u.map(e=>{e.id===i&&(e.itemsInCart=parseInt(t.innerText),v())})}else t.map(t=>{t.id===i&&(t.itemsInCart=+r,u.push(t),s(t),m(),v())});n.querySelector("[data-counter]").innerText="1",m(),v()}}))}(),"undefined"!=typeof ymaps&&ymaps.ready((function(){var t=new ymaps.Map("map",{center:[56.141051,47.194952],zoom:12}),e=document.querySelector("#myadress").innerHTML;ymaps.geocode(e).then((function(n){var i=n.geoObjects.get(0).geometry.getCoordinates();t.setCenter(i,16,{checkZoomRange:!0});var r=new ymaps.Placemark(i,{hintContent:e,balloonContent:"Время работы: Пн-Пт, с 9 до 20"},{iconLayout:"default#image",iconImageHref:"../img/icon.svg",iconImageSize:[40,52],iconImageOffset:[-5,-38]},{preset:"islands#redDotIcon"});t.geoObjects.add(r),t.behaviors.disable("scrollZoom")}))}));